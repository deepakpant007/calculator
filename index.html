<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Line Efficiency Calculator</title>

<style>
:root{
  --primary:#2563eb;
  --secondary:#16a34a;
  --accent:#f59e0b;
  --danger:#dc2626;
  --bg:#f1f5f9;
  --card:#ffffff;
  --text:#1f2937;
}

*{box-sizing:border-box}
body{
  font-family:'Segoe UI',Roboto,Arial;
  background:var(--bg);
  margin:0;
  padding:20px;
  color:var(--text);
}

h2,h3{
  margin:0 0 10px;
  text-align:center;
}

.container{
  background:var(--card);
  border-radius:14px;
  padding:20px;
  max-width:1300px;
  margin:0 auto 20px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}

.header{
  background:linear-gradient(135deg,var(--primary),#1e40af);
  color:#fff;
  border-radius:12px;
  padding:20px;
  margin-bottom:20px;
}

.row{
  display:flex;
  flex-wrap:wrap;
  gap:15px;
}

.col{
  flex:1;
  min-width:260px;
  background:#f8fafc;
  padding:15px;
  border-radius:12px;
  border:1px solid #e5e7eb;
}

label{
  font-size:13px;
  margin-top:8px;
  display:block;
  font-weight:600;
}

input,select,textarea{
  width:100%;
  padding:8px 10px;
  border-radius:8px;
  border:1px solid #d1d5db;
  font-size:13px;
  margin-top:4px;
}

input[readonly]{
  background:#e5e7eb;
  font-weight:600;
}

textarea{
  min-height:110px;
}

button{
  padding:10px 16px;
  border:none;
  border-radius:10px;
  cursor:pointer;
  font-weight:600;
}

.btn-primary{
  background:var(--primary);
  color:white;
}

.btn-secondary{
  background:var(--secondary);
  color:white;
}

.btn-accent{
  background:var(--accent);
  color:black;
}

button:hover{opacity:.9}

.summary{
  white-space:pre-wrap;
  background:#0f172a;
  color:#e5e7eb;
  padding:15px;
  border-radius:12px;
  font-family:Consolas,monospace;
  font-size:13px;
}

.footer-buttons{
  display:flex;
  gap:10px;
  margin-top:10px;
  justify-content:center;
}

.line-title{
  text-align:center;
  background:linear-gradient(135deg,#e0f2fe,#bae6fd);
  padding:6px;
  border-radius:8px;
  font-weight:700;
  margin-bottom:10px;
}

.speed-row{
  display:flex;
  gap:6px;
}
</style>
</head>

<body>

<div class="container header">
  <h2>Line Efficiency Calculator</h2>
</div>

<div class="container">
<div class="row">
<div class="col">
<label>Shift</label>
<select id="shift">
<option>A</option><option>B</option><option>C</option>
</select>
</div>
<div class="col">
<label>Date</label>
<input id="date" readonly>
</div>
<div class="col">
<label>Time</label>
<input id="time" readonly>
</div>
</div>
</div>

<div class="container">
<h3>Previous Hour Summary (Optional)</h3>
<textarea id="prevSummary"></textarea>
<button class="btn-accent" onclick="parseSummary()">Parse Summary</button>
</div>

<div class="container">
<div class="row">

<script>
const skus={
 "200 ml PDW":48,"250 ml PDW":24,"500 ml PDW":24,
 "1000 ml PDW":12,"2000 ml PDW":9,
 "250 ml NMW":24,"500 ml NMW":20,"1000 ml NMW":12
};

for(let i=1;i<=3;i++){
document.write(`
<div class="col">
<div class="line-title">Line ${i}</div>

<label>SKU</label>
<select id="sku${i}" onchange="calc(${i})">
${Object.keys(skus).map(s=>`<option>${s}</option>`).join("")}
</select>

<label>Total Filler Counter</label>
<input type="number" id="total${i}" oninput="calc(${i})">

<label>Previous Hour Counter</label>
<input type="number" id="prev${i}" oninput="calc(${i})">

<label>Filler Counter</label>
<input id="filler${i}" readonly>

<label>Speed</label>
<div class="speed-row">
<input type="number" id="speed${i}" oninput="calc(${i})">
<select id="unit${i}" onchange="calc(${i})">
<option>BPM</option>
<option>BPH</option>
</select>
</div>

<label>Number of Cases</label>
<input id="cases${i}" readonly>

<label>Efficiency (%)</label>
<input id="eff${i}" readonly>
</div>
`);
}
</script>

</div>

<div style="text-align:center;margin-top:15px">
<button class="btn-primary" onclick="calculateAll()">Calculate</button>
</div>
</div>

<div class="container">
<h3>Summary</h3>
<div id="summary" class="summary"></div>

<div class="footer-buttons">
<button class="btn-secondary" onclick="copySummary()">Copy</button>
<button class="btn-primary" onclick="shareWhatsApp()">WhatsApp</button>
</div>
</div>

<script>
function pad(n){return n<10?"0"+n:n}

function setDateTime(){
const now=new Date()
const shift=shiftEl.value

const end=new Date(now)
end.setMinutes(0,0,0)
const start=new Date(end)
start.setHours(start.getHours()-1)

let d=new Date(now)
if(shift==="C" && end.getHours()<7){d.setDate(d.getDate()-1)}

date.value=`${pad(d.getDate())}/${pad(d.getMonth()+1)}/${String(d.getFullYear()).slice(-2)}`

function t(x){
let h=x.getHours(),m=pad(x.getMinutes())
let a=h>=12?"PM":"AM";h=h%12||12
return `${h}:${m} ${a}`
}
time.value=`${t(start)} to ${t(end)}`
}

function calc(i){
const filler=Math.max((+totalEl(i).value||0)-(+prevEl(i).value||0),0)
fillerEl(i).value=filler

const bpc=skus[skuEl(i).value]
const actualCases=Math.floor(filler/bpc)
casesEl(i).value=actualCases

const speed=+speedEl(i).value||0
const bottlesPerHour=unitEl(i).value==="BPM"?speed*60:speed
const theoreticalCases=bottlesPerHour>0?bottlesPerHour/bpc:0

effEl(i).value=theoreticalCases?((actualCases/theoreticalCases)*100).toFixed(2):"0.00"
}

function calculateAll(){
setDateTime()
let out=`Date: ${date.value}
Shift: ${shiftEl.value}
Time: ${time.value}\n\n`

for(let i=1;i<=3;i++){
if(+fillerEl(i).value>0){
out+=`Line ${i}: ${skuEl(i).value}
Filler Counter: ${fillerEl(i).value}
Total Filler Counter: ${totalEl(i).value}
Number of Cases: ${casesEl(i).value}
Net Efficiency: ${effEl(i).value}%\n\n`
}}

out+="Breakdown:\n"
for(let i=1;i<=3;i++){
const eff=+effEl(i).value
if(eff>0){
out+=`Line ${i} (${skuEl(i).value}): ${((1-eff/100)*60).toFixed(2)} minutes\n`
}}

summary.textContent=out.trim()
}

function parseSummary(){
const t=prevSummary.value
for(let i=1;i<=3;i++){
const r=new RegExp(`Line ${i}: (.+)[\\s\\S]*?Total Filler Counter: (\\d+)`)
const m=t.match(r)
if(m){skuEl(i).value=m[1];prevEl(i).value=m[2]}
}
}

function copySummary(){navigator.clipboard.writeText(summary.textContent)}
function shareWhatsApp(){
window.open(`https://wa.me/?text=${encodeURIComponent(summary.textContent)}`,"_blank")
}

const skuEl=i=>document.getElementById("sku"+i)
const speedEl=i=>document.getElementById("speed"+i)
const unitEl=i=>document.getElementById("unit"+i)
const totalEl=i=>document.getElementById("total"+i)
const prevEl=i=>document.getElementById("prev"+i)
const fillerEl=i=>document.getElementById("filler"+i)
const casesEl=i=>document.getElementById("cases"+i)
const effEl=i=>document.getElementById("eff"+i)
const shiftEl=document.getElementById("shift")

setDateTime()
shiftEl.addEventListener("change",setDateTime)
</script>

</body>
</html>
